<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Chapter&nbsp;4.&nbsp;GitLab integration</title><link rel="stylesheet" type="text/css" href="css/manual-multipage.css"><meta name="generator" content="DocBook XSL Stylesheets V1.78.1"><link rel="home" href="index.html" title="Git as Subversion"><link rel="up" href="index.html" title="Git as Subversion"><link rel="prev" href="ch03.html" title="Chapter&nbsp;3.&nbsp;Installation"><link rel="next" href="ch_props.html" title="Chapter&nbsp;5.&nbsp;SVN Properties"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Chapter&nbsp;4.&nbsp;GitLab integration</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch03.html">Prev</a>&nbsp;</td><th width="60%" align="center">&nbsp;</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="ch_props.html">Next</a></td></tr></table><hr></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="d5e329"></a>Chapter&nbsp;4.&nbsp;GitLab integration</h1></div></div></div>
  

  <div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e331"></a>Recommended GitLab patches</h2></div></div></div>
    

    <p>For integration with GitLab install the following patches on GitLab:</p>

    <div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
        <p><a class="ulink" href="https://github.com/gitlabhq/gitlab-shell/pull/230" target="_top">#230 (gitlab-shell)</a><span class="phrase">: Add
        git-lfs-authenticate to server white list (merged to
        7.14.1);</span></p>
      </li><li class="listitem">
        <p><a class="ulink" href="https://github.com/gitlabhq/gitlab-shell/pull/237" target="_top">#237 (gitlab-shell)</a><span class="phrase">:
        Execute git-lfs-authenticate command with original arguments (merged
        to 8.2.0);</span></p>
      </li><li class="listitem">
        <p><a class="ulink" href="https://github.com/gitlabhq/gitlabhq/pull/9591" target="_top">#9591 (gitlabhq)</a><span class="phrase">: Add API
        for lookup user information by SSH key ID (merged to
        8.0.0);</span></p>
      </li><li class="listitem">
        <p><a class="ulink" href="https://github.com/gitlabhq/gitlabhq/pull/9728" target="_top">#9728 (gitlabhq)</a><span class="phrase">: Show
        "Empty Repository Page" for repository without branches (merged to
        8.2.0).</span></p>
      </li></ul></div>
  </div>

  <div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e351"></a>GitLab intergration points</h2></div></div></div>
    

    <p>There are some intgeration points with GitLab:</p>

    <div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">
        <p>The list of repositories</p>

        <p>Git as a Subversion automatically retrieves the list of repositories on startup via the GitLab API.</p>

        <p>Further, this list is updated by System Hook, which is registered automatically.</p>
      </li><li class="listitem">
        <p>Authorization and authentication of users</p>

        <p>For authenticating users and repository permission control is also used GitLab API.</p>
      </li><li class="listitem">
        <p>Git Hooks</p>

        <p>When you commit using Git as Subversion the GitLab hooks are executed. These hooks, in particular, allow to see information about new commits without delay via the GitLab WEB interface.</p>

        <p>GitLab Hooks require GitLab user ID information (GL_ID environment variable) received at user authorization.</p>

        <div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="images/important.svg"></td><th align="left">Important</th></tr><tr><td align="left" valign="top">
          <p>Because of this, in the case of integration with GitLab user authentication must be via GitLab.</p>
        </td></tr></table></div>
      </li><li class="listitem">
        <p>Git LFS</p>

        <p>In the case of GitLFS need to specify the path to GitLab LFS storage.</p>

        <p>GitLab from version 8.2 uses single LFS-files storage shared between all repositories. Files are stored in a separate directory as raw data.</p>

        <p>Integration with LFS repository GitLab occurs at the file level. GitLab API is not used.</p>
      </li><li class="listitem">
        <p>Git LFS authorization for SSH users</p>

        <p>Unfortunately, GitLab does't provide the git-lfs-authenticate script, which is responsible for SSO authorization SSH-user Git on the server LFS. To configure this script, see <a class="xref" href="ch03.html#git-lfs-authenticate" title="Package git-as-svn-lfs">the section called &#8220;Package git-as-svn-lfs&#8221;</a>.</p>
      </li></ul></div>
  </div>

  <div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e377"></a>Adding a SVN-link to GitLab interface</h2></div></div></div>
    

    <p>To add a SVN-link to GitLab interface need to take latest commit of branch <a class="ulink" href="https://github.com/bozaro/gitlabhq/commits/svn_url" target="_top">https://github.com/bozaro/gitlabhq/commits/svn_url</a>.</p>

    <div class="screenshot">
      <p class="title"><b>Example of SVN-link in GitLab interface</b></p>

      <div class="mediaobject"><img src="images/gitlab_svn_url.png"></div>
    </div>
  </div>

  <div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d5e388"></a>Configuration file example</h2></div></div></div>
    

    <pre class="programlisting"><span class="hl-attribute">&nbsp;&nbsp;1 !config</span>:
&nbsp;&nbsp;2 <span class="hl-attribute">realm</span>: Example realm
&nbsp;&nbsp;3 <span class="hl-attribute">compressionEnabled</span>: <span class="hl-keyword">true</span>
&nbsp;&nbsp;4 
&nbsp;&nbsp;5 <span class="hl-comment"># Use GitLab repositories</span>
&nbsp;&nbsp;6 <span class="hl-attribute">repositoryMapping</span>: !gitlabMapping
&nbsp;&nbsp;7 <span class="hl-attribute">  path</span>: /var/opt/gitlab/git-data/repositories/
&nbsp;&nbsp;8 <span class="hl-attribute">  template</span>:
&nbsp;&nbsp;9 <span class="hl-attribute">    branch</span>: master
&nbsp;10 <span class="hl-attribute">    renameDetection</span>: <span class="hl-keyword">true</span>
&nbsp;11 
&nbsp;12 <span class="hl-comment"># Use GitLab user database</span>
&nbsp;13 <span class="hl-attribute">userDB</span>: !gitlabUsers <span class="hl-keyword">{}</span>
&nbsp;14 
&nbsp;15 <span class="hl-attribute">shared</span>:
&nbsp;16   <span class="hl-comment"># Web server settings</span>
&nbsp;17 <span class="hl-attribute">  # Used for</span>:
&nbsp;18   <span class="hl-comment">#  * detecticting add/remove repositories via GitLab System Hook</span>
&nbsp;19   <span class="hl-comment">#  * git-lfs-authenticate script (optionaly)</span>
&nbsp;20   - !web
&nbsp;21 <span class="hl-attribute">    baseUrl</span>: http://git-as-svn.local/
&nbsp;22 <span class="hl-attribute">    listen</span>:
&nbsp;23     - !http
&nbsp;24 <span class="hl-attribute">      host</span>: localhost
&nbsp;25 <span class="hl-attribute">      port</span>: <span class="hl-number">8123</span>
&nbsp;26       <span class="hl-comment"># Use X-Forwarded-* headers</span>
&nbsp;27 <span class="hl-attribute">      forwarded</span>: <span class="hl-keyword">true</span>
&nbsp;28   <span class="hl-comment"># GitLab LFS server</span>
&nbsp;29   - !lfs
&nbsp;30     <span class="hl-comment"># Secret token for git-lfs-authenticate script</span>
&nbsp;31 <span class="hl-attribute">    # token</span>: secret
&nbsp;32 <span class="hl-attribute">    path</span>: /mnt/storage/lfs-objects
&nbsp;33 <span class="hl-attribute">    saveMeta</span>: <span class="hl-keyword">false</span>
&nbsp;34 <span class="hl-attribute">    compress</span>: <span class="hl-keyword">false</span>
&nbsp;35 <span class="hl-attribute">    layout</span>: GitLab
&nbsp;36   <span class="hl-comment"># GitLab server</span>
&nbsp;37   - !gitlab
&nbsp;38 <span class="hl-attribute">    url</span>: http://localhost:<span class="hl-number">3000</span>/
&nbsp;39 <span class="hl-attribute">    hookUrl</span>: http://localhost:<span class="hl-number">8123</span>/
&nbsp;40 <span class="hl-attribute">    token</span>: qytzQc6uYiQfsoqJxGuG
&nbsp;41 </pre>
  </div>
</div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch03.html">Prev</a>&nbsp;</td><td width="20%" align="center">&nbsp;</td><td width="40%" align="right">&nbsp;<a accesskey="n" href="ch_props.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Chapter&nbsp;3.&nbsp;Installation&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;Chapter&nbsp;5.&nbsp;SVN Properties</td></tr></table></div></body></html>